import * as THREE from 'three';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
import { FaceLandmarker, FilesetResolver } from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.7";

// ... [previous scene setup code] ...

async function setupAI() {
    try {
        const vision = await FilesetResolver.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.7/wasm");
        landmarker = await FaceLandmarker.createFromOptions(vision, {
            baseOptions: { 
                modelAssetPath: "https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",
                delegate: "GPU" 
            },
            runningMode: "VIDEO"
        });
        
        // Model loading with relative path fix
        const loader = new GLTFLoader();
        loader.load('./model.glb', (gltf) => {
            scene.add(gltf.scene);
            document.getElementById('loading').style.display = 'none';
        }, undefined, (e) => console.error("GLB Load Error:", e));

        const stream = await navigator.mediaDevices.getUserMedia({ video: { width: 1280, height: 720 } });
        video.srcObject = document.getElementById('v-prev').srcObject = stream;
        video.onloadeddata = () => loop();
    } catch (e) {
        console.error("Setup Error:", e);
    }
}
